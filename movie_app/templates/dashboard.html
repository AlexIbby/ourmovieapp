{% extends "base.html" %}
{% block content %}
<!-- Tabbed Interface for Search and Filters -->
<div class="search-filter-tabs mb-3">
  <!-- Tab Navigation -->
  <ul class="nav nav-pills search-tabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="search-tab" data-bs-toggle="pill" data-bs-target="#search-pane" type="button" role="tab" aria-controls="search-pane" aria-selected="true">
        <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor" class="me-1">
          <path fill-rule="evenodd" d="M8.5 3a5.5 5.5 0 0 1 4.27 8.99l3.12 3.12a.75.75 0 1 1-1.06 1.06l-3.12-3.12A5.5 5.5 0 1 1 8.5 3zm0 1.5a4 4 0 1 0 0 8 4 4 0 0 0 0-8z" clip-rule="evenodd" />
        </svg>
        Search Movies
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="filter-tab" data-bs-toggle="pill" data-bs-target="#filter-pane" type="button" role="tab" aria-controls="filter-pane" aria-selected="false">
        <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor" class="me-1">
          <path fill-rule="evenodd" d="M2.628 1.601C5.028 1.206 7.49 1 10 1s4.973.206 7.372.601a.75.75 0 01.628.74v2.288a2.25 2.25 0 01-.659 1.59l-4.682 4.683a2.25 2.25 0 00-.659 1.59v3.037c0 .684-.31 1.33-.844 1.757l-1.937 1.55A.75.75 0 018 18.25v-5.757a2.25 2.25 0 00-.659-1.591L2.659 6.22A2.25 2.25 0 012 4.629V2.34a.75.75 0 01.628-.74z" clip-rule="evenodd" />
        </svg>
        Filter Library
      </button>
    </li>
  </ul>

  <!-- Tab Content -->
  <div class="tab-content search-tab-content">
    <!-- Search Tab -->
    <div class="tab-pane fade show active" id="search-pane" role="tabpanel" aria-labelledby="search-tab">
      <div class="d-flex align-items-center gap-2 flex-wrap">
        <div class="input-group" style="min-width: 280px; flex: 1 1 320px;">
          <span class="input-group-text" title="Search">
            <svg width="22" height="22" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" focusable="false" style="display:block">
              <path fill-rule="evenodd" d="M8.5 3a5.5 5.5 0 0 1 4.27 8.99l3.12 3.12a.75.75 0 1 1-1.06 1.06l-3.12-3.12A5.5 5.5 0 1 1 8.5 3zm0 1.5a4 4 0 1 0 0 8 4 4 0 0 0 0-8z" clip-rule="evenodd" />
            </svg>
          </span>
          <input id="searchInput" class="form-control" type="search" placeholder="Search TMDB for a movieâ€¦" autocomplete="off">
        </div>
        <input id="searchYear" class="form-control" type="number" placeholder="Year" min="1900" max="2030" style="max-width: 120px; flex: 0 0 120px;">
        <input id="searchDirector" class="form-control" type="text" placeholder="Director (optional)" autocomplete="off" style="min-width: 220px; flex: 1 1 220px;">
        <button id="clearSearchBtn" class="btn btn-outline-secondary">Clear</button>
      </div>
      <div class="mt-2">
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="checkbox" id="searchLibraryOnly" value="">
          <label class="form-check-label" for="searchLibraryOnly">
            Search library only
          </label>
        </div>
      </div>
    </div>

    <!-- Filter Tab -->
    <div class="tab-pane fade" id="filter-pane" role="tabpanel" aria-labelledby="filter-tab">
      <div class="filter-container-compact">
        <div class="filter-row">
          <div class="filter-group">
            <label class="filter-label">Genre</label>
            <div class="genre-checklist" id="genreChecklist">
              <div class="genre-selected-info" id="genreSelectedInfo">
                <span class="selected-count">0 genres selected</span>
                <button type="button" class="clear-genres-btn" id="clearGenresBtn">Clear All</button>
              </div>
              <div class="genre-options" id="genreCheckboxes">
                <!-- Checkboxes will be populated by JavaScript -->
              </div>
            </div>
            <select id="genreFilter" class="filter-select d-none" multiple>
              <option value="">All Genres</option>
            </select>
          </div>
          <div class="filter-group">
            <label class="filter-label">Year From</label>
            <input id="yearFromFilter" type="number" class="filter-input" placeholder="1900" min="1900" max="2030">
          </div>
          <div class="filter-group">
            <label class="filter-label">Year To</label>
            <input id="yearToFilter" type="number" class="filter-input" placeholder="2030" min="1900" max="2030">
          </div>
          <div class="filter-group">
            <label class="filter-label">User Tags</label>
            <select id="tagFilter" class="filter-select" multiple>
              <option value="">All Tags</option>
            </select>
          </div>
          <div class="filter-group">
            <label class="filter-label">Min Rating</label>
            <select id="ratingFilter" class="filter-select">
              <option value="">Any Rating</option>
              <option value="1">1+ Stars</option>
              <option value="2">2+ Stars</option>
              <option value="3">3+ Stars</option>
              <option value="4">4+ Stars</option>
              <option value="5">5 Stars Only</option>
            </select>
          </div>
        </div>
        <div class="filter-buttons">
          <button id="applyFilters" class="filter-btn">Apply Filters</button>
          <button id="clearFilters" class="filter-btn clear">Clear All</button>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="searchSection" class="mb-4 d-none">
  <h6 class="mb-2">Search Results</h6>
  <div id="searchResults" class="row g-3"></div>
</div>

<div class="d-flex justify-content-between align-items-center mb-2">
  <div>
    <h5 class="mb-0" id="libraryHeading" tabindex="-1">Your Shared Library</h5>
    <div class="text-muted small" id="libraryStats">
      <span id="totalMoviesText">Loading...</span><br>
      <span id="unratedMoviesText">Loading...</span>
    </div>
  </div>
  <div class="d-flex align-items-center gap-2">
    <button id="unratedFilterBtn" class="btn btn-outline-primary" type="button" aria-pressed="false">
      Unrated Only
    </button>
  </div>
</div>
<div id="libraryGrid" class="row g-3"></div>

<nav class="mt-3" aria-label="Movies pagination">
  <ul id="pagination" class="pagination"></ul>
</nav>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow-lg">
      <div class="modal-header bg-danger text-white border-0">
        <h5 class="modal-title" id="deleteModalLabel">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-2" style="vertical-align: text-bottom;">
            <polyline points="3 6 5 6 21 6"></polyline>
            <path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"></path>
            <path d="M10 11v6"></path>
            <path d="M14 11v6"></path>
            <path d="M9 6V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"></path>
          </svg>
          Delete Movie
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body p-4">
        <div class="d-flex align-items-start gap-3">
          <div class="flex-shrink-0">
            <div class="bg-danger bg-opacity-10 rounded-circle p-2">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-danger">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="15" y1="9" x2="9" y2="15"></line>
                <line x1="9" y1="9" x2="15" y2="15"></line>
              </svg>
            </div>
          </div>
          <div class="flex-grow-1">
            <h6 class="mb-2">Are you sure you want to delete this movie?</h6>
            <p class="text-muted mb-3" id="deleteMovieTitle">Movie title will appear here</p>
            <div class="alert alert-warning border-0 bg-warning bg-opacity-10">
              <small class="text-warning-emphasis">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-1">
                  <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path>
                  <line x1="12" y1="9" x2="12" y2="13"></line>
                  <line x1="12" y1="17" x2="12.01" y2="17"></line>
                </svg>
                This will permanently remove the movie and all associated ratings and tags.
              </small>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer border-0 bg-light">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" id="confirmDeleteBtn">
          <span class="delete-text">Delete Movie</span>
          <span class="delete-spinner d-none">
            <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
            Deleting...
          </span>
        </button>
      </div>
    </div>
  </div>
</div>
{% endblock %}
